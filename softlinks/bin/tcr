#!/usr/bin/env bash

# Test && Commit || Revert, pioneered by Kent Beck
# https://youtu.be/FFzHOyFeovE
which entr > /dev/null || {
  echo "brew install entr"
  return 1
}
projectRoot=$(git rev-parse --show-toplevel) # for monorepo
commitedFiles=$(git diff origin/master... --name-only)
changedFiles=$(git status --porcelain | awk '{print $2}')
echo "$projectRoot/$commitedFiles" "$projectRoot/$changedFiles" | xargs ls | entr -c sh -c "echo && $* && git add . || git checkout ."
